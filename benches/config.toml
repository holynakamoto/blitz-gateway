# Blitz Gateway Benchmark Configuration
# Comprehensive benchmarking setup for performance testing

[benchmark]
name = "blitz-gateway-benchmarks"
description = "Complete benchmark suite for Blitz Gateway performance validation"
version = "1.0.0"
author = "Blitz Gateway Team"

# Global benchmark settings
[benchmark.global]
warmup_seconds = 10
cooldown_seconds = 5
iterations = 3
confidence_level = 0.95
output_format = "json"

# Server configuration
[server]
host = "127.0.0.1"
port = 8080
protocol = "http"
tls_enabled = false
quic_enabled = false
reuse_port = true

# TLS settings (when enabled)
[server.tls]
cert_path = "certs/server.crt"
key_path = "certs/server.key"
min_version = "TLS1.2"
cipher_suites = [
    "TLS_AES_128_GCM_SHA256",
    "TLS_AES_256_GCM_SHA384",
    "TLS_CHACHA20_POLY1305_SHA256"
]

# QUIC settings (when enabled)
[server.quic]
port = 8443
max_idle_timeout = 30
max_streams = 100
initial_max_data = 1048576
initial_max_stream_data_bidi_local = 262144
initial_max_stream_data_bidi_remote = 262144

# Load testing configuration
[load_test]
# Connection settings
connections = 100
threads = 4
duration_seconds = 30
rate_limit = 0  # 0 = unlimited

# Request patterns
[load_test.patterns]
read_heavy = { get_percentage = 90, post_percentage = 10 }
write_heavy = { get_percentage = 30, post_percentage = 70 }
mixed = { get_percentage = 50, post_percentage = 50 }

# Test scenarios
[[scenarios]]
name = "http_get_homepage"
description = "Basic HTTP GET request to homepage"
method = "GET"
path = "/"
headers = [
    "Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8",
    "User-Agent: Blitz-Benchmark/1.0"
]
body = ""
weight = 80

[[scenarios]]
name = "http_get_api"
description = "API endpoint GET request"
method = "GET"
path = "/api/v1/status"
headers = [
    "Accept: application/json",
    "Authorization: Bearer benchmark-token",
    "User-Agent: Blitz-Benchmark/1.0"
]
body = ""
weight = 15

[[scenarios]]
name = "http_post_api"
description = "API endpoint POST request"
method = "POST"
path = "/api/v1/data"
headers = [
    "Content-Type: application/json",
    "Accept: application/json",
    "Authorization: Bearer benchmark-token",
    "User-Agent: Blitz-Benchmark/1.0"
]
body = '''
{
    "timestamp": "2024-01-01T00:00:00Z",
    "data": {
        "sensor_id": "benchmark-sensor-001",
        "temperature": 25.5,
        "humidity": 65.0,
        "pressure": 1013.25
    },
    "metadata": {
        "version": "1.0",
        "source": "benchmark-suite"
    }
}
'''
weight = 5

# WebSocket scenarios (disabled by default)
[[scenarios]]
name = "websocket_echo"
description = "WebSocket echo test"
enabled = false
method = "WS"
path = "/ws/echo"
headers = ["Sec-WebSocket-Version: 13"]
messages = 1000
message_size = 1024
weight = 0

# Metrics collection
[metrics]
# System metrics
collect_system_metrics = true
system_metrics_interval = 5

# Application metrics
collect_server_metrics = true
server_metrics_endpoint = "http://127.0.0.1:9090/metrics"

# Custom metrics
[metrics.custom]
response_time_histogram = true
error_rate_counter = true
throughput_gauge = true

# Export options
[metrics.export]
prometheus = true
prometheus_gateway = "http://127.0.0.1:9091"
json_file = true
csv_file = true
influxdb = false
influxdb_url = "http://127.0.0.1:8086"
influxdb_database = "blitz_benchmarks"

# Performance thresholds and alerts
[thresholds]
# Response time thresholds (milliseconds)
p50_response_time = 10
p95_response_time = 50
p99_response_time = 100

# Throughput thresholds
min_requests_per_second = 1000
target_requests_per_second = 10000

# Error rate thresholds
max_error_rate_percentage = 1.0

# Resource usage thresholds
max_cpu_usage_percentage = 80
max_memory_usage_percentage = 85

# Regression detection
[regression]
enabled = true
baseline_file = "baseline.json"
max_degradation_percentage = 10
min_improvement_percentage = 5

# Statistical analysis
[regression.stats]
significance_level = 0.05
minimum_samples = 5
outlier_detection = true
trend_analysis = true

# Reporting
[report]
title = "Blitz Gateway Performance Report"
include_charts = true
include_raw_data = true
include_system_info = true
output_formats = ["html", "json", "pdf"]

# Distribution options
[report.distribution]
email_enabled = false
email_recipients = []
slack_webhook = ""
github_comment = true

# Benchmark environment
[environment]
name = "local-development"
description = "Local development environment"
tags = ["development", "local", "benchmark"]

# Hardware specification
[environment.hardware]
cpu_model = "auto"
cpu_cores = "auto"
memory_gb = "auto"
storage_type = "auto"
network_interface = "auto"

# Software versions
[environment.software]
os = "auto"
kernel = "auto"
zig_version = "auto"
openssl_version = "auto"

# Benchmark profiles
[profiles.basic]
description = "Basic performance validation"
scenarios = ["http_get_homepage"]
duration_seconds = 30
connections = 50

[profiles.standard]
description = "Standard load testing"
scenarios = ["http_get_homepage", "http_get_api", "http_post_api"]
duration_seconds = 60
connections = 100

[profiles.stress]
description = "Stress testing under high load"
scenarios = ["http_get_homepage", "http_get_api", "http_post_api"]
duration_seconds = 120
connections = 500

[profiles.endurance]
description = "Long-running endurance test"
scenarios = ["http_get_homepage", "http_get_api"]
duration_seconds = 1800  # 30 minutes
connections = 200

# Tool-specific configurations
[tools.wrk]
enabled = true
script_path = "scripts/bench/wrk_script.lua"
timeout = 30

[tools.hey]
enabled = true
disable_keepalive = false
disable_compression = false

[tools.bombardier]
enabled = true
insecure = true
timeout = "10s"

[tools.vegeta]
enabled = false
rate = "1000/1s"
duration = "30s"
